- name: Formatação de partição root
  community.general.filesystem:
    fstype: "{{ formato }}"
    dev: "{{ root }}"
  when: root | length > 0 and formato | length > 0

- name: Formatação de partição home
  community.general.filesystem:
    fstype: ext4
    dev: "{{ home }}"
  when: home | length > 0

- name: Formatação de partição swap
  community.general.filesystem:
    fstype: swap
    dev: "{{ swap }}"
  when: swap | length > 0

- name: Formatação de partição boot
  community.general.filesystem:
    fstype: vfat
    dev: "{{ boot }}"
  when: boot | length > 0

- name: Ativar root
  ansible.posix.mount:
    path: /mnt
    src: "{{ root }}"
    fstype: "{{ formato }}"
    state: mounted
  when: root | length > 0 and formato | length > 0

- name: Criar diretório da home
  ansible.builtin.file:
    path: /mnt/home/
    state: directory
    mode: '0755'
  when: home | length > 0

- name: Criar diretório da boot
  ansible.builtin.file:
    path: /mnt/boot/
    state: directory
    mode: '0755'
  when: boot | length > 0

- name: Ativar swap
  ansible.builtin.command:
    cmd: "swapon {{ swap }}"
  when: swap | length > 0
  changed_when: false

- name: Ativar home
  ansible.posix.mount:
    path: /mnt/home
    src: "{{ home }}"
    fstype: ext4
    state: mounted
  when: home | length > 0 and root | length > 0 and formato | length > 0

- name: Ativar boot
  ansible.posix.mount:
    path: /mnt/boot
    src: "{{ boot }}"
    fstype: vfat
    state: mounted
  when: boot | length > 0 and root | length > 0 and formato | length > 0
